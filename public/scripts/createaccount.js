const usernameInputElement=document.getElementById("username"),emailInputElement=document.getElementById("email"),passwordInputElement=document.getElementById("password"),submitButton=document.getElementById("submit");let data;fetch("/createaccount/data").then((e=>e.json())).then((e=>{data=e}));let usernameHasError=!1;usernameInputElement.addEventListener("input",(e=>{let t=document.getElementById("usernameerror");const n=usernameInputElement.value.length<3,r=!onlyLettersAndNumbers(usernameInputElement.value),a=!!data&&(!n&&-1!==data.reservedUsernames.indexOf(usernameInputElement.value.toLowerCase())),s=!!data&&(!n&&checkProfanity(usernameInputElement.value));n||r||a||s?t||(usernameHasError=!0,createErrorElement("usernameerror","usernameinputline"),usernameInputElement.style.outline="solid 1px red",t=document.getElementById("usernameerror")):t&&(usernameHasError=!1,t.remove(),usernameInputElement.removeAttribute("style")),n&&r?t.textContent="Username must be atleast 3 characters long, and only contain letters A-Z and numbers 0-9":n?t.textContent="Username must be atleast 3 characters long":r?t.textContent="Username must only contain letters A-Z and numbers 0-9":a?t.textContent="That username is reserved":s&&(t.textContent="That username contains a word that is not allowed"),updateSubmitButton()})),usernameInputElement.addEventListener("focusout",(e=>{0===usernameInputElement.value.length||usernameHasError||fetch(`/createaccount/username/${usernameInputElement.value}`).then((e=>e.json())).then((e=>{!0!==e[0]&&(usernameHasError=!0,createErrorElement("usernameerror","usernameinputline"),usernameInputElement.style.outline="solid 1px red",usernameError=document.getElementById("usernameerror"),usernameError.textContent="That username is taken",updateSubmitButton())}))}));let emailHasError=!1;emailInputElement.addEventListener("input",(e=>{let t=document.getElementById("emailerror");const n=!validEmail(emailInputElement.value);n?t||(emailHasError=!0,createErrorElement("emailerror","emailinputline"),emailInputElement.style.outline="solid 1px red",t=document.getElementById("emailerror")):t&&(emailHasError=!1,t.remove(),emailInputElement.removeAttribute("style")),n&&(t.textContent="This is not a valid email"),updateSubmitButton()})),emailInputElement.addEventListener("focusout",(e=>{emailInputElement.value.length>1&&!emailHasError&&fetch(`/createaccount/email/${emailInputElement.value}`).then((e=>e.json())).then((e=>{if(!1===e[0]){emailHasError=!0,createErrorElement("emailerror","emailinputline"),emailInputElement.style.outline="solid 1px red";document.getElementById("emailerror").textContent="This email is already in use",updateSubmitButton()}}))}));let passwordHasError=!1;passwordInputElement.addEventListener("input",(e=>{let t=document.getElementById("passworderror");const n=passwordInputElement.value.length<6||passwordInputElement.value.length>30,r=!validPassword(passwordInputElement.value),a="password"===passwordInputElement.value.toLowerCase();n||r||a?t||(passwordHasError=!0,createErrorElement("passworderror","passwordinputline"),passwordInputElement.style.outline="solid 1px red",t=document.getElementById("passworderror")):t&&(passwordHasError=!1,t.remove(),passwordInputElement.removeAttribute("style")),r?t.textContent="Password is in an incorrect format":n?t.textContent="Password must be between 6-30 characters long":a&&(t.textContent="Password must not be 'password'"),updateSubmitButton()})),submitButton.addEventListener("click",(e=>{e.preventDefault(),!usernameHasError&&!emailHasError&&!passwordHasError&&usernameInputElement.value&&emailInputElement.value&&passwordInputElement.value&&sendForm(usernameInputElement.value,emailInputElement.value,passwordInputElement.value)})),sendForm=function(e,t,n){let r=!1,a={method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify({username:e,email:t,password:n})};fetch("/createaccount",a).then((e=>(e.ok&&(r=!0),e.json()))).then((t=>{window.location.href=r?`/member/${e.toLowerCase()}`:"/409"}))},createErrorElement=function(e,t){const n=document.createElement("div");n.className="error",n.id=e,document.getElementById(t).insertAdjacentElement("afterend",n)};const updateSubmitButton=function(){usernameHasError||emailHasError||passwordHasError||!usernameInputElement.value||!emailInputElement.value||!passwordInputElement.value?submitButton.className="unavailable":submitButton.className="ready"};function getCookieValue(e){const t=document.cookie.split("; ");for(let n=0;n<t.length;n++){const r=t[n].split("=");if(r[0]===e)return r[1]}}onlyLettersAndNumbers=function(e){return!e||/^[a-zA-Z0-9]+$/.test(e)},checkProfanity=function(e){for(let t=0;t<data.profainWords.length;t++)if(profanity=data.profainWords[t],e.toLowerCase().includes(profanity))return!0;return!1},validEmail=function(e){return!0===/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/.test(e)},validPassword=function(e){return!0===/^[a-zA-Z0-9!@#$%^&*\?]+$/.test(e)};